<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç† (Cloud)</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Mail Cloud">
  
  <!-- iOSç”¨ã‚¢ã‚¤ã‚³ãƒ³è‡ªå‹•ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script>
    (function(){
      var c = document.createElement('canvas');
      c.width = 256; c.height = 256;
      var ctx = c.getContext('2d');
      // èƒŒæ™¯ã‚’ã‚ªãƒ¬ãƒ³ã‚¸ã«
      ctx.fillStyle = '#ea580c';
      ctx.fillRect(0,0,256,256);
      // ç™½ã„ãƒ¡ãƒ¼ãƒ«ã®ç·šã‚’æç”»
      ctx.strokeStyle = '#ffffff';
      ctx.lineWidth = 16;
      ctx.lineJoin = 'round';
      ctx.lineCap = 'round';
      ctx.strokeRect(48, 72, 160, 112);
      ctx.beginPath();
      ctx.moveTo(48, 72);
      ctx.lineTo(128, 136);
      ctx.lineTo(208, 72);
      ctx.stroke();
      
      // ç”Ÿæˆã—ãŸç”»åƒã‚’PNGãƒ‡ãƒ¼ã‚¿ã«ã—ã¦apple-touch-iconã¨ã—ã¦Headã«æ³¨å…¥
      var link = document.createElement('link');
      link.rel = 'apple-touch-icon';
      link.href = c.toDataURL('image/png');
      document.head.appendChild(link);
      
      var icon = document.createElement('link');
      icon.rel = 'icon';
      icon.type = 'image/png';
      icon.href = c.toDataURL('image/png');
      document.head.appendChild(icon);
    })();
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Firebase å®‰å®šç‰ˆ SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

  <style>
    body { -webkit-tap-highlight-color: transparent; }
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    .pt-safe { padding-top: env(safe-area-inset-top); }
    .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    .animate-fade-in-up { animation: fadeInUp 0.3s ease-out; }
    @keyframes fadeInUp { from { opacity: 0; transform: translate(-50%, 10px); } to { opacity: 1; transform: translate(-50%, 0); } }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const Icon = ({ path, size = 24, className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
    );
    const Search = (p) => <Icon {...p} path={<g><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></g>} />;
    const Copy = (p) => <Icon {...p} path={<g><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></g>} />;
    const Plus = (p) => <Icon {...p} path={<g><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></g>} />;
    const Edit2 = (p) => <Icon {...p} path={<g><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></g>} />;
    const Trash2 = (p) => <Icon {...p} path={<g><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2-2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></g>} />;
    const Check = (p) => <Icon {...p} path={<polyline points="20 6 9 17 4 12"/>} />;
    const Send = (p) => <Icon {...p} path={<g><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></g>} />;
    const Folder = (p) => <Icon {...p} path={<g><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></g>} />;
    const MessageSquare = (p) => <Icon {...p} path={<g><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></g>} />;
    const Clock = (p) => <Icon {...p} path={<g><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></g>} />;
    const RotateCcw = (p) => <Icon {...p} path={<g><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></g>} />;
    const Save = (p) => <Icon {...p} path={<g><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></g>} />;
    const X = (p) => <Icon {...p} path={<g><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></g>} />;
    const Menu = (p) => <Icon {...p} path={<g><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></g>} />;
    const Smartphone = (p) => <Icon {...p} path={<g><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></g>} />;
    const Settings = (p) => <Icon {...p} path={<g><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/><circle cx="12" cy="12" r="3"/></g>} />;
    const ChevronDown = (p) => <Icon {...p} path={<polyline points="6 9 12 15 18 9"/>} />;
    const AlertTriangle = (p) => <Icon {...p} path={<g><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></g>} />;

    const CATEGORY_GROUPS = [
      { id: 'general', label: '', items: [{ id: 'all', name: 'ã™ã¹ã¦', icon: <Folder size={18} /> }] },
      { id: 'standard', label: 'é€šå¸¸å¯¾å¿œ', items: [
        { id: 'initial', name: 'åˆæœŸå¯¾å¿œ', icon: <MessageSquare size={18} /> },
        { id: 'followup', name: 'è¿½æ’ƒãƒ»æ¤œè¨ä¼ºã„', icon: <Clock size={18} /> },
        { id: 'reengage', name: 'é•·æœŸãƒ»æ˜ã‚Šèµ·ã“ã—', icon: <RotateCcw size={18} /> },
      ]},
      { id: 'satei', label: 'ä¸€æ‹¬æŸ»å®šå¯¾å¿œç”¨ï¼ˆEãƒ¡ãƒ¼ãƒ«ï¼‰', items: [
        { id: 'satei_initial', name: 'åˆæœŸå¯¾å¿œï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰', icon: <MessageSquare size={18} /> },
        { id: 'satei_followup', name: 'è¿½å®¢ãƒ»è¿½æ’ƒï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰', icon: <Clock size={18} /> },
        { id: 'satei_reengage', name: 'é•·æœŸãƒ»æ˜ã‚Šèµ·ã“ã—ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰', icon: <RotateCcw size={18} /> },
      ]},
      { id: 'satei_sms', label: 'ä¸€æ‹¬æŸ»å®šå¯¾å¿œç”¨ï¼ˆSMSï¼‰', items: [
        { id: 'satei_initial_sms', name: 'åˆæœŸå¯¾å¿œï¼ˆSMSï¼‰', icon: <Smartphone size={18} /> },
        { id: 'satei_followup_sms', name: 'è¿½å®¢ãƒ»è¿½æ’ƒï¼ˆSMSï¼‰', icon: <Smartphone size={18} /> },
        { id: 'satei_reengage_sms', name: 'é•·æœŸãƒ»æ˜ã‚Šèµ·ã“ã—ï¼ˆSMSï¼‰', icon: <Smartphone size={18} /> },
      ]}
    ];

    const ALL_CATEGORIES = CATEGORY_GROUPS.flatMap(group => group.items);

    const INITIAL_TEMPLATES = [
      {
        id: 1,
        title: 'è³‡æ–™è«‹æ±‚ã¸ã®ãŠç¤¼ï¼ˆå³ãƒ¬ã‚¹ç”¨ï¼‰',
        category: 'initial',
        subject: 'ã€è³‡æ–™é€ä»˜ã®ã”æ¡ˆå†…ã€‘ï¼»è‡ªç¤¾åï¼½ æ‹…å½“ã®ï¼»æ‹…å½“è€…åï¼½ã§ã™',
        body: `ï¼»ãŠå®¢æ§˜åï¼½æ§˜

ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚
ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã§ã”ã–ã„ã¾ã™ã€‚

ã“ã®åº¦ã¯ã€å¼Šç¤¾ã‚µãƒ¼ãƒ“ã‚¹ã®è³‡æ–™ã‚’ã”è«‹æ±‚ã„ãŸã ãã€
èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

æ—©é€Ÿã§ã¯ã”ã–ã„ã¾ã™ãŒã€è³‡æ–™ï¼ˆPDFï¼‰ã‚’ãŠé€ã‚Šã„ãŸã—ã¾ã™ã€‚
æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã”ç¢ºèªã„ãŸã ã‘ã¾ã™ã§ã—ã‚‡ã†ã‹ã€‚

ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
â– æ·»ä»˜è³‡æ–™
ãƒ»ä¼šç¤¾æ¦‚è¦.pdf
ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ç´¹ä»‹è³‡æ–™.pdf
ãƒ»å°å…¥äº‹ä¾‹é›†.pdf
ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼

è²´ç¤¾ã®èª²é¡Œè§£æ±ºã®ä¸€åŠ©ã¨ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

ã”ä¸æ˜ç‚¹ã‚„ã€ã€Œã¾ãšã¯è©±ã‚’èã„ã¦ã¿ãŸã„ã€ã¨ã„ã†ã”è¦æœ›ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€
æœ¬ãƒ¡ãƒ¼ãƒ«ã¸ã®è¿”ä¿¡ã€ã¾ãŸã¯ä¸‹è¨˜é›»è©±ç•ªå·ã¾ã§ãŠæ°—è»½ã«ã”é€£çµ¡ãã ã•ã„ã€‚

å¼•ãç¶šãä½•å’ã‚ˆã‚ã—ããŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™.`
      },
      {
        id: 2,
        title: 'æ—¥ç¨‹èª¿æ•´ã®æ‰“è¨ºï¼ˆåˆå›ï¼‰',
        category: 'initial',
        subject: 'ã€ãŠæ‰“ã¡åˆã‚ã›ã®ã”ç›¸è«‡ã€‘ï¼»è‡ªç¤¾åï¼½',
        body: `ï¼»ãŠå®¢æ§˜åï¼½æ§˜

ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚
ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã§ã”ã–ã„ã¾ã™ã€‚

å…ˆã»ã©ã¯è³‡æ–™ã‚’ã”è¦§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
ã‚‚ã—ã‚ˆã‚ã—ã‘ã‚Œã°ã€è²´ç¤¾ã®ç¾çŠ¶ã‚„èª²é¡Œæ„Ÿã«åˆã‚ã›ã¦
ã‚ˆã‚Šå…·ä½“çš„ãªäº‹ä¾‹ã‚„ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã”ç´¹ä»‹ã§ãã‚Œã°ã¨è€ƒãˆã¦ãŠã‚Šã¾ã™ã€‚

ã¤ãã¾ã—ã¦ã¯ã€20åˆ†ï½30åˆ†ã»ã©ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«ã¦
æƒ…å ±äº¤æ›ã®ãŠæ™‚é–“ã‚’ã„ãŸã ã‘ãªã„ã§ã—ã‚‡ã†ã‹ã€‚

ä»¥ä¸‹ã®æ—¥ç¨‹ã§ã”éƒ½åˆã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ã€‚

â– å€™è£œæ—¥æ™‚
ãƒ»ã€‡æœˆã€‡æ—¥ï¼ˆæ›œï¼‰ 10:00ï½18:00
ãƒ»ã€‡æœˆã€‡æ—¥ï¼ˆæ›œï¼‰ 13:00ï½16:00
ãƒ»ã€‡æœˆã€‡æ—¥ï¼ˆæ›œï¼‰ 10:00ï½12:00

ä¸Šè¨˜ä»¥å¤–ã‚’ã”å¸Œæœ›ã®å ´åˆã¯ã€ã”éƒ½åˆã®è‰¯ã„æ—¥æ™‚ã‚’
ã„ãã¤ã‹ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚

ã”æ¤œè¨ã®ã»ã©ã€ã‚ˆã‚ã—ããŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™.`
      },
      {
        id: 3,
        title: 'æ¤œè¨çŠ¶æ³ã®ç¢ºèªï¼ˆ1é€±é–“å¾Œï¼‰',
        category: 'followup',
        subject: 'å…ˆæ—¥ãŠé€ã‚Šã—ãŸè³‡æ–™ã«ã¤ãã¾ã—ã¦ã€ï¼»è‡ªç¤¾åï¼½ã€‘',
        body: `ï¼»ãŠå®¢æ§˜åï¼½æ§˜

ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚
ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã§ã™ã€‚

å…ˆæ—¥ãŠé€ã‚Šã„ãŸã—ã¾ã—ãŸè³‡æ–™ã¯ã”è¦§ã„ãŸã ã‘ã¾ã—ãŸã§ã—ã‚‡ã†ã‹ã€‚

ã‚‚ã—ã”ä¸æ˜ãªç‚¹ã‚„ã€
ã€Œã‚‚ã£ã¨ã“ã“ã‚’è©³ã—ãçŸ¥ã‚ŠãŸã„ã€ã¨ã„ã£ãŸç®‡æ‰€ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€
æ‹…å½“ã®ç§ã¾ã§ãŠæ°—è»½ã«ãŠç”³ã—ä»˜ã‘ãã ã•ã„ã€‚

ã¾ãŸã€åŒæ¥­ä»–ç¤¾æ§˜ã§ã®å°å…¥äº‹ä¾‹ãªã©ã‚’ã¾ã¨ã‚ãŸ
è¿½åŠ è³‡æ–™ã‚‚ã”ç”¨æ„ãŒå¯èƒ½ã§ã”ã–ã„ã¾ã™ã€‚

ã”èˆˆå‘³ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãœã²ä¸€åº¦æƒ…å ±æä¾›ã®æ©Ÿä¼šã‚’ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚

ãŠæ‰‹ã™ãã®éš›ã«ã”è¿”ä¿¡ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚
ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™.`
      },
      {
        id: 4,
        title: 'éŸ³ä¿¡ä¸é€šæ™‚ã®å†é€£çµ¡ï¼ˆã‚¯ãƒƒã‚·ãƒ§ãƒ³ï¼‰',
        category: 'followup',
        subject: 'ã€å†é€ã€‘ã”æ¤œè¨çŠ¶æ³ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹',
        body: `ï¼»ãŠå®¢æ§˜åï¼½æ§˜

ã„ã¤ã‚‚å¤§å¤‰ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚
ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã§ã™ã€‚

åº¦ã€…ã®ã”é€£çµ¡ã¨ãªã‚Šå¤§å¤‰æç¸®ã§ã”ã–ã„ã¾ã™ã€‚

ä»¥å‰ã”ææ¡ˆã•ã›ã¦ã„ãŸã ãã¾ã—ãŸä»¶ã«ã¤ãã¾ã—ã¦ã€
ãã®å¾Œã€ã”æ¤œè¨çŠ¶æ³ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ã€‚

ã”å¤šå¿™ä¸­ã¨ã¯å­˜ã˜ã¾ã™ãŒã€
ç¾çŠ¶ã«ã¤ã„ã¦ä¸€è¨€ã ã‘ã§ã‚‚ã”æ•™ç¤ºã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚
ï¼ˆã€Œæ™‚æœŸå°šæ—©ã€ã€Œä»–ç¤¾ã«æ±ºå®šã€ç­‰ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ï¼‰

ä½•å’ã‚ˆã‚ã—ããŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™.`
      },
      {
        id: 5,
        title: 'åŠå¹´å¾Œã®æ˜ã‚Šèµ·ã“ã—ï¼ˆæ–°æ©Ÿèƒ½ãƒ»äº‹ä¾‹ï¼‰',
        category: 'reengage',
        subject: 'ã€æ–°æ©Ÿèƒ½ã®ã”æ¡ˆå†…ã€‘èª²é¡Œè§£æ±ºã«å½¹ç«‹ã¤æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ',
        body: `ï¼»ãŠå®¢æ§˜åï¼½æ§˜

å¤§å¤‰ã”ç„¡æ²™æ±°ã—ã¦ãŠã‚Šã¾ã™ã€‚
ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã§ã”ã–ã„ã¾ã™ã€‚

ä»¥å‰ã¯å¼Šç¤¾ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã”æ¤œè¨ã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

ã“ã®åº¦ã€ä»¥å‰æ‡¸å¿µã•ã‚Œã¦ã„ãŸç‚¹ã‚’è§£æ¶ˆã§ãã‚‹
ã€Œæ–°æ©Ÿèƒ½ã€ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã®ã§ã€
æ”¹ã‚ã¦ã”æ¡ˆå†…ã•ã›ã¦ã„ãŸã ããŸãã”é€£çµ¡ã„ãŸã—ã¾ã—ãŸã€‚

â–¼æ–°æ©Ÿèƒ½ã®ãŠçŸ¥ã‚‰ã›
ï¼ˆURLã‚„è©³ç´°ã‚’è¨˜è¼‰ï¼‰

ç¾åœ¨ã®çŠ¶æ³ã«åˆã‚ã›ã¦ã€
æ”¹ã‚ã¦ãŠå½¹ã«ç«‹ã¦ã‚‹ã”ææ¡ˆãŒã§ãã‚‹ã‹ã¨å­˜ã˜ã¾ã™ã€‚

ã‚‚ã—ã‚ˆã‚ã—ã‘ã‚Œã°ã€æœ€æ–°ã®è³‡æ–™ã‚’ãŠé€ã‚Šã™ã‚‹ã‹ã€
ä¸€åº¦è¿‘æ³ã‚’ãŠä¼ºã„ã§ãã‚Œã°ã¨è€ƒãˆã¦ãŠã‚Šã¾ã™ã€‚

ã”èˆˆå‘³ã‚’ãŠæŒã¡ã„ãŸã ã‘ã¾ã—ãŸã‚‰ã€
æœ¬ãƒ¡ãƒ¼ãƒ«ã¸ã”è¿”ä¿¡ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚

å­£ç¯€ã®å¤‰ã‚ã‚Šç›®ã§ã™ã®ã§ã€ã”è‡ªæ„›ãã ã•ã„ã¾ã›.`
      },
      {
        id: 8,
        title: 'æœºä¸ŠæŸ»å®šå ±å‘Šæ›¸ã®é€ä»˜ï¼ˆEãƒ¡ãƒ¼ãƒ«ï¼‰',
        category: 'satei_initial',
        subject: 'ã€æœºä¸ŠæŸ»å®šå ±å‘Šæ›¸ã®ã”é€ä»˜ã€‘ï¼»è‡ªç¤¾åï¼½ æ‹…å½“ï¼šï¼»æ‹…å½“è€…åï¼½',
        body: `ï¼»ãŠå®¢æ§˜åï¼½ æ§˜

çªç„¶ã®ã”é€£çµ¡ã«ã¦å¤±ç¤¼ã„ãŸã—ã¾ã™ã€‚
ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã¨ç”³ã—ã¾ã™ã€‚

ã“ã®åº¦ã¯ã€ä¸å‹•ç”£ä¸€æ‹¬æŸ»å®šã‚µã‚¤ãƒˆã€Œï¼»åª’ä½“åï¼½ã€ã‚’é€šã˜ã¦ã€ 
ã”æ‰€æœ‰ä¸å‹•ç”£ã®æŸ»å®šã‚’ã”ä¾é ¼ã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

ã€æŸ»å®šç‰©ä»¶ã€‘ ï¼»ç‰©ä»¶ã®ã‚¨ãƒªã‚¢ãƒ»ç¨®åˆ¥ï¼½

ï¼»åª’ä½“åï¼½é‹å–¶ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼æ§˜ã‚’é€šã˜ã¦ã€ 
ã€Œï¼»ãŠå®¢æ§˜ã®ã”äº‹æƒ…1ï¼½ã€
ã€Œï¼»ãŠå®¢æ§˜ã®ã”äº‹æƒ…2ï¼½ã€ 
ã¨ã„ã†ã”äº‹æƒ…ã‚’æ‰¿ã‚Šã¾ã—ãŸã€‚

æœºä¸ŠæŸ»å®šã«ã¯ãªã‚Šã¾ã™ãŒã€ä¸‹è¨˜3ç‚¹ã®è³‡æ–™ãƒ‡ãƒ¼ã‚¿ã‚’æ·»ä»˜ã„ãŸã—ã¾ã™ã®ã§ã€
ã”æŸ»åã„ãŸã ãã¾ã™ã‚ˆã†ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚

ã€‡æŸ»å®šå ±å‘Šæ›¸
ã€‡èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆãŠã‚ˆã³èª¿æŸ»è³‡æ–™
ã€‡æˆç´„äº‹ä¾‹ï¼è¿‘éš£è²©å£²åœ¨åº«

ãŠæ‰‹æ•°ã‚’ãŠã‹ã‘ã„ãŸã—ã¾ã™ãŒã€ãƒ¡ãƒ¼ãƒ«ã‚’ã”ç¢ºèªã§ããŸå ´åˆã€
ãã®æ—¨ã®ã”è¿”ä¿¡ã‚’ã„ãŸã ããŸãå­˜ã˜ã¾ã™ã€‚
ãƒ‡ãƒ¼ã‚¿æ·»ä»˜ã§ã™ã¨ã€è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ã«å…¥ã£ã¦ã—ã¾ã£ã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

ä½•å’ã€ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™.`
      },
      {
        id: 9,
        title: 'ãã®å¾Œã®çŠ¶æ³ç¢ºèªï¼å†æŸ»å®šã®ã”æ¡ˆå†…',
        category: 'satei_followup',
        subject: 'ã”æ‰€æœ‰ä¸å‹•ç”£ã®æŸ»å®šã«ã¤ãã¾ã—ã¦ã€ï¼»è‡ªç¤¾åï¼½ã€‘',
        body: `ï¼»ãŠå®¢æ§˜åï¼½æ§˜

ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚
ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã§ã™ã€‚

å…ˆæ—¥ãŠé€ã‚Šã—ãŸæŸ»å®šçµæœã«ã¤ã„ã¦ã€ãã®å¾Œã”æ¤œè¨çŠ¶æ³ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿ

ã‚‚ã—çŠ¶æ³ãªã©ã«å¤‰åŒ–ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ç¾åœ¨ã®æœ€æ–°ã®ç›¸å ´ã«ã¦æ”¹ã‚ã¦æŸ»å®šã—ç›´ã™ã“ã¨ã‚‚å¯èƒ½ã§ã”ã–ã„ã¾ã™ã€‚
ã”ä¸æ˜ç‚¹ã‚„ã”ç›¸è«‡ãªã©ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€æœ¬ãƒ¡ãƒ¼ãƒ«ã¸ã”è¿”ä¿¡ã„ãŸã ãã‹ã€ä¸‹è¨˜ã¾ã§ãŠæ°—è»½ã«ã”é€£çµ¡ãã ã•ã„ã€‚

å¼•ãç¶šãã‚ˆã‚ã—ããŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™.`
      },
      {
        id: 10,
        title: 'æŸ»å®šæ›¸ï¼ˆéƒµé€ï¼‰ã®åˆ°ç€ç¢ºèª',
        category: 'satei_followup',
        subject: 'æŸ»å®šæ›¸ã®ã”éƒµé€ã«ã¤ãã¾ã—ã¦ã€ï¼»è‡ªç¤¾åï¼½ã€‘',
        body: `ï¼»ãŠå®¢æ§˜åï¼½æ§˜

ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚
ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã§ã™ã€‚

å…ˆæ—¥ã”éƒµé€ã«ã¦ãŠé€ã‚Šã„ãŸã—ã¾ã—ãŸæŸ»å®šæ›¸ã§ã™ãŒã€ç„¡äº‹ã«ãŠæ‰‹å…ƒã«å±Šã„ã¦ãŠã‚Šã¾ã™ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ä¸‡ãŒä¸€ã€ã¾ã å±Šã„ã¦ã„ãªã„ã‚ˆã†ã§ã‚ã‚Œã°å†é€ã„ãŸã—ã¾ã™ã®ã§ã€å¤§å¤‰ãŠæ‰‹æ•°ã§ã™ãŒãã®æ—¨ã‚’ã”è¿”ä¿¡ã„ãŸã ã‘ã¾ã™ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚

å†…å®¹ã«ã¤ã„ã¦ã®ã”ä¸æ˜ç‚¹ãªã©ã‚‚ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚
ä½•å’ã‚ˆã‚ã—ããŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™.`
      },
      {
        id: 11,
        title: 'æŸ»å®šæ›¸ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰ã®åˆ°ç€ç¢ºèª',
        category: 'satei_followup',
        subject: 'æŸ»å®šæ›¸ã®ã”é€ä»˜ã«ã¤ãã¾ã—ã¦ã€ï¼»è‡ªç¤¾åï¼½ã€‘',
        body: `ï¼»ãŠå®¢æ§˜åï¼½æ§˜

ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚
ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã§ã™ã€‚

å…ˆæ—¥ãƒ¡ãƒ¼ãƒ«ã«ã¦ãŠé€ã‚Šã„ãŸã—ã¾ã—ãŸæŸ»å®šæ›¸ã§ã™ãŒã€ç„¡äº‹ã«ã”ç¢ºèªã„ãŸã ã‘ã¾ã—ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿ

ãƒ‡ãƒ¼ã‚¿æ·»ä»˜ã®ãŸã‚ã€ç¨€ã«è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€ã«å…¥ã£ã¦ã—ã¾ã£ã¦ã„ã‚‹å¯èƒ½æ€§ã‚‚ã”ã–ã„ã¾ã™ã€‚
ã‚‚ã—å±Šã„ã¦ã„ãªã„ã‚ˆã†ã§ã‚ã‚Œã°å†é€ã„ãŸã—ã¾ã™ã®ã§ã€å¤§å¤‰ãŠæ‰‹æ•°ã§ã™ãŒãã®æ—¨ã‚’ã”è¿”ä¿¡ã„ãŸã ã‘ã¾ã™ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚

ä½•å’ã‚ˆã‚ã—ããŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™.`
      },
      {
        id: 6,
        title: 'ã€SMSç”¨ã€‘æ‰€åœ¨åœ°ä¸æ˜ãƒ»é›»è©±ä¸é€šæ™‚ï¼ˆæºå¸¯ã‹ã‚‰æ¶é›»ï¼‰',
        category: 'satei_initial_sms',
        subject: 'ï¼ˆSMSç”¨ã®ãŸã‚ä»¶åä¸è¦ï¼‰',
        body: `ã€ï¼»åª’ä½“åï¼½ï¼šç‰©ä»¶æŸ»å®šã®ä»¶ã€‘

ï¼»ãŠå®¢æ§˜åï¼½æ§˜

ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã§ã™ã€‚

å…ˆã»ã©ã€æºå¸¯ç•ªå·ï¼»æºå¸¯é›»è©±ç•ªå·ï¼½ã‚ˆã‚ŠãŠé›»è©±å·®ã—ä¸Šã’ã¾ã—ãŸã€‚
ãŠä»•äº‹ä¸­ã§ã—ãŸã§ã—ã‚‡ã†ã‹ã€å¤±ç¤¼ã„ãŸã—ã¾ã—ãŸã€‚

ï¼»ç‰©ä»¶ã®ã‚¨ãƒªã‚¢ãƒ»ç¨®åˆ¥ï¼½ã«é–¢ã—ã¾ã—ã¦ã€æ­£ç¢ºãªæ‰€åœ¨åœ°ãªã©ã®æŸ»å®šã«å¿…è¦ãªã”æƒ…å ±ãŒä¸è¶³ã—ã¦ãŠã‚Šã¾ã—ãŸã®ã§ã€ã”ç¢ºèªã•ã›ã¦ã„ãŸã ããŸãå­˜ã˜ã¾ã™ã€‚

ãŠæ‰‹ã™ãã®éš›ã«ã€ã“ã¡ã‚‰ã®æºå¸¯ï¼ˆã¾ãŸã¯SMSï¼‰ã¸æŠ˜ã‚Šè¿”ã—ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚

ãŠé›»è©±ã§ã®ã”å¯¾å¿œãŒé›£ã—ã„å ´åˆã¯ã€ãã®æ—¨ã‚’ã”è¿”ä¿¡ãã ã•ã„ã¾ã›ã€‚

æ‹…å½“:ï¼»æ‹…å½“è€…åï¼½(ï¼»æºå¸¯é›»è©±ç•ªå·ï¼½)`
      },
      {
        id: 15,
        title: 'ã€SMSç”¨ã€‘æ‰€åœ¨åœ°ä¸æ˜ãƒ»é›»è©±ä¸é€šæ™‚ï¼ˆäº‹å‹™æ‰€ã‹ã‚‰æ¶é›»ï¼‰',
        category: 'satei_initial_sms',
        subject: 'ï¼ˆSMSç”¨ã®ãŸã‚ä»¶åä¸è¦ï¼‰',
        body: `ã€ï¼»åª’ä½“åï¼½ï¼šç‰©ä»¶æŸ»å®šã®ä»¶ã€‘

ï¼»ãŠå®¢æ§˜åï¼½æ§˜

ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã§ã™ã€‚

å…ˆã»ã©ã€äº‹å‹™æ‰€ï¼ˆï¼»äº‹å‹™æ‰€é›»è©±ç•ªå·ï¼½ï¼‰ã‚ˆã‚ŠãŠé›»è©±å·®ã—ä¸Šã’ã¾ã—ãŸã€‚
ãŠä»•äº‹ä¸­ã§ã—ãŸã§ã—ã‚‡ã†ã‹ã€å¤±ç¤¼ã„ãŸã—ã¾ã—ãŸã€‚

ï¼»ç‰©ä»¶ã®ã‚¨ãƒªã‚¢ãƒ»ç¨®åˆ¥ï¼½ã«é–¢ã—ã¾ã—ã¦ã€æ­£ç¢ºãªæ‰€åœ¨åœ°ãªã©ã®æŸ»å®šã«å¿…è¦ãªã”æƒ…å ±ãŒä¸è¶³ã—ã¦ãŠã‚Šã¾ã—ãŸã®ã§ã€ã”ç¢ºèªã•ã›ã¦ã„ãŸã ããŸãå­˜ã˜ã¾ã™ã€‚

ãŠæ‰‹ã™ãã®éš›ã«ã€ã“ã¡ã‚‰ã®ç•ªå·ï¼ˆã¾ãŸã¯SMSï¼‰ã¸æŠ˜ã‚Šè¿”ã—ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚

ãŠé›»è©±ã§ã®ã”å¯¾å¿œãŒé›£ã—ã„å ´åˆã¯ã€ãã®æ—¨ã‚’ã”è¿”ä¿¡ãã ã•ã„ã¾ã›ã€‚

æ‹…å½“:ï¼»æ‹…å½“è€…åï¼½(ï¼»äº‹å‹™æ‰€é›»è©±ç•ªå·ï¼½)`
      },
      {
        id: 12,
        title: 'ã€SMSç”¨ã€‘ãã®å¾Œã®çŠ¶æ³ç¢ºèªï¼å†æŸ»å®šã®ã”æ¡ˆå†…',
        category: 'satei_followup_sms',
        subject: 'ï¼ˆSMSç”¨ã®ãŸã‚ä»¶åä¸è¦ï¼‰',
        body: `ã€ï¼»åª’ä½“åï¼½ï¼šç‰©ä»¶æŸ»å®šã®ä»¶ã€‘

ï¼»ãŠå®¢æ§˜åï¼½æ§˜

ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã§ã™ã€‚

å…ˆæ—¥ã®æŸ»å®šã«ã¤ãã¾ã—ã¦ã€ãã®å¾Œã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼ŸçŠ¶æ³ãŒå¤‰ã‚ã‚‰ã‚Œã¦ã„ã‚Œã°ã€æ”¹ã‚ã¦æŸ»å®šã—ç›´ã™ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ã”ä¸æ˜ç‚¹ãŒã‚ã‚Œã°ã„ã¤ã§ã‚‚ã”é€£çµ¡ãã ã•ã„ã€‚

æ‹…å½“:ï¼»æ‹…å½“è€…åï¼½(ï¼»æºå¸¯é›»è©±ç•ªå·ï¼½)`
      },
      {
        id: 13,
        title: 'ã€SMSç”¨ã€‘æŸ»å®šæ›¸ï¼ˆéƒµé€ï¼‰ã®åˆ°ç€ç¢ºèª',
        category: 'satei_followup_sms',
        subject: 'ï¼ˆSMSç”¨ã®ãŸã‚ä»¶åä¸è¦ï¼‰',
        body: `ã€ï¼»åª’ä½“åï¼½ï¼šç‰©ä»¶æŸ»å®šã®ä»¶ã€‘

ï¼»ãŠå®¢æ§˜åï¼½æ§˜

ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã§ã™ã€‚

å…ˆæ—¥ã”éƒµé€ã„ãŸã—ã¾ã—ãŸæŸ»å®šæ›¸ã¯ã€ç„¡äº‹ãŠæ‰‹å…ƒã«å±Šã„ã¦ãŠã‚Šã¾ã™ã§ã—ã‚‡ã†ã‹ï¼Ÿã‚‚ã—å±Šã„ã¦ã„ãªã„ã‚ˆã†ã§ã‚ã‚Œã°å†é€ã„ãŸã—ã¾ã™ã®ã§ã€ãã®æ—¨ã‚’ã”è¿”ä¿¡ã„ãŸã ã‘ã¾ã™ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚

æ‹…å½“:ï¼»æ‹…å½“è€…åï¼½(ï¼»æºå¸¯é›»è©±ç•ªå·ï¼½)`
      },
      {
        id: 14,
        title: 'ã€SMSç”¨ã€‘æŸ»å®šæ›¸ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰ã®åˆ°ç€ç¢ºèª',
        category: 'satei_followup_sms',
        subject: 'ï¼ˆSMSç”¨ã®ãŸã‚ä»¶åä¸è¦ï¼‰',
        body: `ã€ï¼»åª’ä½“åï¼½ï¼šç‰©ä»¶æŸ»å®šã®ä»¶ã€‘

ï¼»ãŠå®¢æ§˜åï¼½æ§˜

ï¼»è‡ªç¤¾åï¼½ã®ï¼»æ‹…å½“è€…åï¼½ã§ã™ã€‚

å…ˆæ—¥ãƒ¡ãƒ¼ãƒ«ã«ã¦é€ä¿¡ã„ãŸã—ã¾ã—ãŸæŸ»å®šæ›¸ã¯ã€ç„¡äº‹ã«ã”ç¢ºèªã„ãŸã ã‘ã¾ã—ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿã‚‚ã—å±Šã„ã¦ã„ãªã„ã‚ˆã†ã§ã‚ã‚Œã°å†é€ã„ãŸã—ã¾ã™ã®ã§ã€ãã®æ—¨ã‚’ã”è¿”ä¿¡ã„ãŸã ã‘ã¾ã™ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚

æ‹…å½“:ï¼»æ‹…å½“è€…åï¼½(ï¼»æºå¸¯é›»è©±ç•ªå·ï¼½)`
      }
    ];

    function App() {
      const [db, setDb] = useState(null);
      const [user, setUser] = useState(null);
      const [configInput, setConfigInput] = useState("");
      const [isConfigured, setIsConfigured] = useState(() => !!localStorage.getItem("firebase_config"));
      const [appError, setAppError] = useState(null);

      const [templates, setTemplates] = useState([]);
      const [settings, setSettings] = useState({ mediaList: ['ã™ã¾ã„ã‚¹ãƒ†ãƒƒãƒ—', 'ãƒªãƒ“ãƒ³ãƒãƒƒãƒ'], companyName: '', staffName: '', mobilePhone: '', officePhone: '' });
      const [activeCategory, setActiveCategory] = useState('satei_initial');
      const [searchQuery, setSearchQuery] = useState('');
      const [editingTemplate, setEditingTemplate] = useState(null);
      const [notification, setNotification] = useState(null);
      const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
      const [copyModal, setCopyModal] = useState(null);
      const [modalInputs, setModalInputs] = useState({});
      const [newMediaInput, setNewMediaInput] = useState('');

      const appId = "mail-template-app";

      useEffect(() => {
        const savedConfig = localStorage.getItem("firebase_config");
        if (savedConfig) {
          try {
            const config = JSON.parse(savedConfig);
            if (!firebase.apps.length) firebase.initializeApp(config);
            const app = firebase.app();
            const _auth = app.auth();
            const _db = app.firestore();
            
            setDb(_db);
            
            _auth.signInAnonymously().catch(e => {
                let errorMsg = "ã€ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ã€‘\n" + e.message;
                if (e.message.includes("unauthorized-domain") || e.code === "auth/unauthorized-domain") {
                    errorMsg += "\n\nğŸ’¡åŸå› : GitHub Pagesã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nFirebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ã€ŒAuthenticationã€>ã€Œè¨­å®šã€>ã€Œæ‰¿èªæ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³ã€ã« krnd6n9chk-ai.github.io ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚";
                }
                setAppError(errorMsg);
            });

            return _auth.onAuthStateChanged((u) => setUser(u));
            
          } catch (e) {
            console.error("Firebase init error:", e);
            localStorage.removeItem("firebase_config");
            setIsConfigured(false);
          }
        }
      }, [isConfigured]);

      useEffect(() => {
        if (!db || !user) return;
        
        const templatesRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('templates');
        const unsubT = templatesRef.onSnapshot((snapshot) => {
          setTemplates(snapshot.docs.map(d => ({id: d.id, ...d.data()})));
        }, (error) => {
          setAppError("ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èª­è¾¼ã‚¨ãƒ©ãƒ¼ã€‘\n" + error.message + "\n\nğŸ’¡åŸå› : Firestoreã®ã€Œãƒ«ãƒ¼ãƒ«ã€ãŒæ­£ã—ããªã„ã‹ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nãƒ«ãƒ¼ãƒ«ãŒ allow read, write: if true; ã«ãªã£ã¦ã„ã‚‹ã‹å†ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        });

        const sRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('settings').doc('global');
        const unsubS = sRef.onSnapshot(doc => {
            if (doc.exists) {
                setSettings(doc.data());
            } else {
                sRef.set({ mediaList: ['ã™ã¾ã„ã‚¹ãƒ†ãƒƒãƒ—', 'ãƒªãƒ“ãƒ³ãƒãƒƒãƒ'], companyName: '', staffName: '', mobilePhone: '', officePhone: '' }).catch(e => console.error(e));
            }
        });

        return () => { unsubT(); unsubS(); };
      }, [db, user]);

      const handleConfigSubmit = () => {
        try {
          let apiKey = configInput.match(/apiKey["'\s:=]+([^"',\s}]+)/i);
          let authDomain = configInput.match(/authDomain["'\s:=]+([^"',\s}]+)/i);
          let projectId = configInput.match(/projectId["'\s:=]+([^"',\s}]+)/i);
          let storageBucket = configInput.match(/storageBucket["'\s:=]+([^"',\s}]+)/i);
          let messagingSenderId = configInput.match(/messagingSenderId["'\s:=]+([^"',\s}]+)/i);
          let appIdValue = configInput.match(/appId["'\s:=]+([^"',\s}]+)/i);

          if (!apiKey || !projectId || !appIdValue) throw new Error("å¿…è¦ãªé …ç›®ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
          if (!apiKey[1].startsWith("AIza")) throw new Error("APIã‚­ãƒ¼ã®å½¢å¼ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚");

          const extractedConfig = { apiKey: apiKey[1], authDomain: authDomain ? authDomain[1] : "", projectId: projectId[1], storageBucket: storageBucket ? storageBucket[1] : "", messagingSenderId: messagingSenderId ? messagingSenderId[1] : "", appId: appIdValue[1] };
          localStorage.setItem("firebase_config", JSON.stringify(extractedConfig));
          setIsConfigured(true);
        } catch (e) {
          alert("ã€è¨­å®šã‚¨ãƒ©ãƒ¼ã€‘\n" + e.message);
        }
      };

      const saveToCloud = async (t) => {
        if (!db || !user) return alert("ã‚¯ãƒ©ã‚¦ãƒ‰ã«æ¥ç¶šã§ãã¦ã„ã¾ã›ã‚“ã€‚å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚");
        const id = t.id || crypto.randomUUID();
        await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('templates').doc(id.toString()).set({ ...t, id }).catch(e => setAppError("ä¿å­˜ã‚¨ãƒ©ãƒ¼: " + e.message));
        setEditingTemplate(null);
        showNotification("ä¿å­˜ã—ã¾ã—ãŸ");
      };

      const deleteFromCloud = async (id) => {
        if (!window.confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
        await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('templates').doc(id.toString()).delete();
      };

      const updateSettings = async (s) => {
        setSettings(s);
        if (db && user) await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('settings').doc('global').set(s);
      };

      const showNotification = (msg) => { setNotification(msg); setTimeout(() => setNotification(null), 3000); };

      const executeCopy = (text, label) => {
        const ta = document.createElement("textarea");
        ta.value = text; document.body.appendChild(ta); ta.select();
        document.execCommand('copy'); document.body.removeChild(ta);
        showNotification(`${label}ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ`);
      };

      const handleCopyRequest = (text, label) => {
        const matches = text.match(/ï¼».+?ï¼½/g);
        if (matches) {
          const unique = [...new Set(matches)];
          setModalInputs(Object.fromEntries(unique.map(ph => [ph, ''])));
          setCopyModal({ text, label, placeholders: unique });
        } else {
          executeCopy(text, label);
        }
      };

      if (!isConfigured) {
        return (
          <div className="min-h-screen bg-slate-900 text-white flex items-center justify-center p-6">
            <div className="max-w-md w-full bg-slate-800 p-8 rounded-2xl shadow-2xl">
              <h2 className="text-2xl font-bold mb-4">Firebaseã®è¨­å®š</h2>
              <textarea className="w-full h-48 p-4 bg-slate-900 border border-slate-700 rounded-lg font-mono text-xs mb-4 focus:ring-2 focus:ring-orange-500 outline-none" placeholder="const firebaseConfig = { ... }; ã®å¡Šã‚’ã‚³ãƒ”ãƒ¼ã—ã¦è²¼ã‚Šä»˜ã‘" value={configInput} onChange={e => setConfigInput(e.target.value)} />
              <button onClick={handleConfigSubmit} className="w-full bg-orange-600 py-3 rounded-lg font-bold">è¨­å®šã‚’ä¿å­˜ã—ã¦é–‹å§‹</button>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-[100dvh] bg-gray-50 flex flex-col md:flex-row relative">
          {appError && (
            <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 p-4 backdrop-blur-sm">
              <div className="bg-white rounded-xl shadow-2xl p-6 max-w-lg w-full">
                <h3 className="text-red-600 font-bold text-xl mb-4 flex items-center gap-2"><AlertTriangle size={24} /> é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h3>
                <pre className="bg-red-50 text-red-800 p-4 rounded text-sm whitespace-pre-wrap font-mono mb-4 border border-red-200">{appError}</pre>
                <div className="flex justify-end gap-3">
                  <button onClick={() => { localStorage.removeItem("firebase_config"); window.location.reload(); }} className="px-4 py-2 border rounded">è¨­å®šã‚’ã‚„ã‚Šç›´ã™</button>
                  <button onClick={() => setAppError(null)} className="px-5 py-2 bg-slate-800 text-white rounded">é–‰ã˜ã‚‹</button>
                </div>
              </div>
            </div>
          )}

          {isMobileMenuOpen && <div className="fixed inset-0 bg-slate-900/50 z-40 md:hidden backdrop-blur-sm" onClick={() => setIsMobileMenuOpen(false)} />}
          
          <aside className={`fixed pt-safe inset-y-0 left-0 z-50 w-72 bg-slate-800 text-white flex flex-col transform transition-transform duration-300 md:relative md:translate-x-0 md:w-64 ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'}`}>
            <div className="p-6 mt-safe flex justify-between items-center">
              <h1 className="text-xl font-bold flex items-center gap-2 text-orange-400"><Send size={24} /> Mail Cloud</h1>
              <button className="md:hidden" onClick={() => setIsMobileMenuOpen(false)}><X size={24} /></button>
            </div>
            <nav className="px-2 pb-4 overflow-y-auto flex-1 custom-scrollbar">
              {CATEGORY_GROUPS.map(group => (
                <div key={group.id} className="mb-6">
                  {group.label && <h3 className="text-xs font-semibold text-slate-500 uppercase tracking-widest mb-2 px-4">{group.label}</h3>}
                  <div className="space-y-1">
                    {group.items.map(cat => (
                      <button key={cat.id} onClick={() => { setActiveCategory(cat.id); setEditingTemplate(null); setIsMobileMenuOpen(false); }} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm transition-colors ${activeCategory === cat.id ? 'bg-orange-600 text-white' : 'text-slate-300 hover:bg-slate-700'}`}>
                        {cat.icon}{cat.name}
                      </button>
                    ))}
                  </div>
                </div>
              ))}
            </nav>
            <div className="p-4 border-t border-slate-700 pb-safe">
              <button onClick={() => { setEditingTemplate({ title: '', category: activeCategory==='all'?'satei_initial':activeCategory, subject: '', body: '' }); setIsMobileMenuOpen(false); }} className="w-full bg-emerald-600 text-white py-3 rounded-lg flex items-center justify-center gap-2 font-bold"><Plus size={18} /> æ–°è¦ä½œæˆ</button>
            </div>
          </aside>

          <main className="flex-1 h-[100dvh] overflow-hidden flex flex-col relative pt-safe">
            <header className="bg-white border-b p-4 shadow-sm z-10 sticky top-0">
              <div className="max-w-5xl mx-auto flex flex-col sm:flex-row justify-between sm:items-center gap-4">
                <div className="flex items-center gap-3">
                  <button className="md:hidden p-2 text-gray-600" onClick={() => setIsMobileMenuOpen(true)}><Menu size={24} /></button>
                  <h2 className="text-lg font-bold">{ALL_CATEGORIES.find(c => c.id === activeCategory)?.name || 'ã™ã¹ã¦'}</h2>
                </div>
                <div className="relative w-full sm:w-80">
                  <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" size={18} />
                  <input type="text" placeholder="æ¤œç´¢..." className="w-full pl-10 pr-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-orange-500" value={searchQuery} onChange={e => setSearchQuery(e.target.value)} />
                </div>
              </div>
            </header>

            <div className="flex-1 overflow-y-auto bg-gray-50 pb-safe px-4 md:px-6">
              {!editingTemplate && (
                <div className="bg-white border-b -mx-4 md:-mx-6 mb-4 px-4 md:px-6 py-3">
                  <details className="group">
                    <summary className="cursor-pointer font-bold text-gray-700 flex items-center justify-between outline-none">
                      <span className="flex items-center gap-2"><Settings size={18} className="text-orange-500" /> åŸºæœ¬è¨­å®šï¼ˆå…¨ãƒ‡ãƒã‚¤ã‚¹åŒæœŸï¼‰</span>
                      <ChevronDown className="group-open:rotate-180 transition-transform text-gray-400" size={18} />
                    </summary>
                    <div className="mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 pb-2">
                      {[['è‡ªç¤¾å', 'companyName'], ['æ‹…å½“è€…å', 'staffName'], ['æºå¸¯', 'mobilePhone'], ['äº‹å‹™æ‰€', 'officePhone']].map(([label, key]) => (
                        <div key={key}>
                          <label className="block text-[10px] font-bold text-gray-400 mb-1">{label}</label>
                          <input type="text" value={settings[key]} onChange={e => updateSettings({...settings, [key]: e.target.value})} className="w-full p-2 border rounded text-sm outline-none focus:ring-1 focus:ring-orange-500" />
                        </div>
                      ))}
                    </div>
                  </details>
                </div>
              )}

              <div className="max-w-5xl mx-auto mt-4">
                {editingTemplate ? (
                  <Editor template={editingTemplate} onSave={saveToCloud} onCancel={() => setEditingTemplate(null)} categories={CATEGORY_GROUPS} />
                ) : (
                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 pb-20">
                    {templates.filter(t => (activeCategory === 'all' || t.category === activeCategory) && (t.title.includes(searchQuery)||t.body.includes(searchQuery))).map(t => (
                      <TemplateCard key={t.id} template={{...t, subject: t.subject.replace(/ï¼»è‡ªç¤¾åï¼½/g, settings.companyName).replace(/ï¼»æ‹…å½“è€…åï¼½/g, settings.staffName).replace(/ï¼»æºå¸¯é›»è©±ç•ªå·ï¼½/g, settings.mobilePhone).replace(/ï¼»äº‹å‹™æ‰€é›»è©±ç•ªå·ï¼½/g, settings.officePhone), body: t.body.replace(/ï¼»è‡ªç¤¾åï¼½/g, settings.companyName).replace(/ï¼»æ‹…å½“è€…åï¼½/g, settings.staffName).replace(/ï¼»æºå¸¯é›»è©±ç•ªå·ï¼½/g, settings.mobilePhone).replace(/ï¼»äº‹å‹™æ‰€é›»è©±ç•ªå·ï¼½/g, settings.officePhone)}} originalTemplate={t} onCopy={handleCopyRequest} onEdit={setEditingTemplate} onDelete={deleteFromCloud} getCategoryName={id => ALL_CATEGORIES.find(c => c.id === id)?.name} />
                    ))}
                  </div>
                )}
              </div>
            </div>

            {notification && <div className="absolute bottom-6 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2 animate-fade-in-up z-50"><Check size={16} className="text-green-400" />{notification}</div>}

            {copyModal && (
              <div className="fixed inset-0 bg-slate-900/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in-up">
                <div className="bg-white rounded-xl shadow-xl max-w-md w-full p-6 flex flex-col max-h-[90vh]">
                  <h3 className="text-lg font-bold mb-4">æœªå…¥åŠ›é …ç›®ã®è¨­å®š</h3>
                  <div className="overflow-y-auto flex-1 space-y-4 pr-2 mb-4">
                    {copyModal.placeholders.map((ph, idx) => (
                      <div key={idx} className="bg-gray-50 p-4 rounded-lg border">
                        <label className="block text-xs font-bold text-gray-500 mb-2">{ph}</label>
                        {ph === 'ï¼»åª’ä½“åï¼½' ? (
                          <div>
                            <div className="flex flex-wrap gap-2 mb-3">
                              {settings.mediaList.map((m, i) => (
                                <button key={i} onClick={() => setModalInputs({...modalInputs, [ph]: m})} className={`px-3 py-2 text-sm font-bold rounded-lg border ${modalInputs[ph]===m?'bg-orange-600 text-white border-orange-600 shadow-md':'bg-white text-orange-600 border-orange-200'}`}>{m}</button>
                              ))}
                            </div>
                            <div className="flex gap-2">
                              <input type="text" value={newMediaInput} onChange={e => setNewMediaInput(e.target.value)} className="flex-1 p-2 border rounded text-sm outline-none" placeholder="æ–°ã—ã„åª’ä½“ã‚’è¿½åŠ " />
                              <button onClick={() => { if(!newMediaInput) return; updateSettings({...settings, mediaList: [...settings.mediaList, newMediaInput]}); setNewMediaInput(''); }} className="px-4 py-2 bg-slate-800 text-white rounded text-xs font-bold">è¿½åŠ </button>
                            </div>
                          </div>
                        ) : (
                          <input type="text" value={modalInputs[ph]} onChange={e => setModalInputs({...modalInputs, [ph]: e.target.value})} className="w-full p-2 border rounded outline-none text-sm focus:ring-1 focus:ring-orange-500" placeholder="å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" />
                        )}
                      </div>
                    ))}
                  </div>
                  <div className="flex justify-end gap-3 pt-4 border-t">
                    <button onClick={() => setCopyModal(null)} className="px-5 py-2 text-gray-400 font-bold">ä¸­æ­¢</button>
                    <button onClick={() => {
                      let res = copyModal.text;
                      copyModal.placeholders.forEach(ph => { res = res.split(ph).join(modalInputs[ph] || ph); });
                      executeCopy(res, copyModal.label); setCopyModal(null);
                    }} className="px-6 py-2 bg-orange-600 text-white rounded shadow-md flex items-center gap-2 font-bold"><Copy size={16} /> ã‚³ãƒ”ãƒ¼å®Ÿè¡Œ</button>
                  </div>
                </div>
              </div>
            )}
          </main>
        </div>
      );
    }

    function TemplateCard({ template, originalTemplate, onCopy, onEdit, onDelete, getCategoryName }) {
      return (
        <div className="bg-white rounded-xl shadow-sm border hover:shadow-md transition-shadow flex flex-col h-full overflow-hidden">
          <div className="p-4 border-b bg-gray-50/50 flex justify-between items-start">
            <div><span className="inline-block px-2 py-0.5 rounded text-[10px] font-bold bg-orange-100 text-orange-700 mb-1">{getCategoryName(template.category)}</span><h3 className="font-bold text-gray-800 leading-tight">{template.title}</h3></div>
            <div className="flex gap-1"><button onClick={() => onEdit(originalTemplate)} className="p-2 text-gray-400 hover:text-blue-600"><Edit2 size={18} /></button><button onClick={() => onDelete(template.id)} className="p-2 text-gray-400 hover:text-red-600"><Trash2 size={18} /></button></div>
          </div>
          <div className="p-4 flex-1 space-y-4">
            <div><div className="text-[10px] font-bold text-gray-400 mb-1 flex justify-between">ä»¶å<button onClick={() => onCopy(template.subject, 'ä»¶å')} className="text-orange-600 font-bold flex items-center gap-1"><Copy size={10} />ã‚³ãƒ”ãƒ¼</button></div><div className="bg-gray-50 p-2 rounded border text-sm text-gray-700 font-medium break-all">{template.subject || '(ä»¶åãªã—)'}</div></div>
            <div><div className="text-[10px] font-bold text-gray-400 mb-1 flex justify-between">æœ¬æ–‡<button onClick={() => onCopy(template.body, 'æœ¬æ–‡')} className="text-orange-600 font-bold flex items-center gap-1"><Copy size={10} />ã‚³ãƒ”ãƒ¼</button></div><div className="bg-gray-50 p-3 rounded border text-sm text-gray-600 font-mono whitespace-pre-wrap h-40 overflow-y-auto custom-scrollbar">{template.body}</div></div>
          </div>
        </div>
      );
    }

    function Editor({ template, onSave, onCancel, categories }) {
      const [formData, setFormData] = useState({ ...template });
      const bodyRef = useRef(null);
      const insert = ph => {
        const start = bodyRef.current.selectionStart;
        const end = bodyRef.current.selectionEnd;
        const body = formData.body || '';
        setFormData({...formData, body: body.substring(0, start) + ph + body.substring(end)});
        setTimeout(() => { bodyRef.current.selectionStart = bodyRef.current.selectionEnd = start + ph.length; bodyRef.current.focus(); }, 0);
      };

      return (
        <div className="bg-white rounded-xl shadow-lg border overflow-hidden animate-fade-in-up">
          <div className="bg-slate-800 text-white px-6 py-4 flex justify-between items-center"><h3 className="font-bold">{template.id?'ç·¨é›†':'æ–°è¦ä½œæˆ'}</h3><button onClick={onCancel}><X size={24} /></button></div>
          <form onSubmit={e => { e.preventDefault(); onSave(formData); }} className="p-6 space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div><label className="block text-xs font-bold text-gray-400 mb-1">ã‚¿ã‚¤ãƒˆãƒ«</label><input type="text" className="w-full p-2 border rounded font-bold" value={formData.title} onChange={e => setFormData({...formData, title: e.target.value})} required /></div>
              <div><label className="block text-xs font-bold text-gray-400 mb-1">ã‚«ãƒ†ã‚´ãƒª</label><select className="w-full p-2 border rounded bg-white font-bold" value={formData.category} onChange={e => setFormData({...formData, category: e.target.value})}>{categories.map(g => g.id!=='general'&&<optgroup key={g.id} label={g.label}>{g.items.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}</optgroup>)}</select></div>
            </div>
            <div><label className="block text-xs font-bold text-gray-400 mb-1">ä»¶å</label><input type="text" className="w-full p-2 border rounded font-bold" value={formData.subject} onChange={e => setFormData({...formData, subject: e.target.value})} /></div>
            <div>
              <div className="flex flex-wrap gap-2 mb-2">
                {['ï¼»ãŠå®¢æ§˜åï¼½', 'ï¼»åª’ä½“åï¼½', 'ï¼»ç‰©ä»¶ã®ã‚¨ãƒªã‚¢ãƒ»ç¨®åˆ¥ï¼½', 'ï¼»è‡ªç¤¾åï¼½', 'ï¼»æ‹…å½“è€…åï¼½'].map(ph => (
                  <button key={ph} type="button" onClick={() => insert(ph)} className="text-[10px] bg-white border border-blue-200 text-blue-600 px-2 py-1 rounded shadow-sm font-bold">{ph}</button>
                ))}
              </div>
              <textarea ref={bodyRef} className="w-full h-64 p-3 border rounded font-mono text-sm outline-none focus:ring-2 focus:ring-orange-500 custom-scrollbar" value={formData.body} onChange={e => setFormData({...formData, body: e.target.value})} required /></div>
            <div className="flex justify-end gap-3"><button type="button" onClick={onCancel} className="px-5 py-2 text-gray-500 font-bold">ä¸­æ­¢</button><button type="submit" className="px-8 py-2 bg-orange-600 text-white rounded shadow-md font-bold">ä¿å­˜ã—ã¦ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ</button></div>
          </form>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
